{% extends "base.html" %}
{% block title %}Guest Articles — TrueFans AMP{% endblock %}
{% block nav_guests %}active{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Guest Articles</h2>
    <p>Manage guest contacts, request articles, and track permissions.</p>
</div>

{% if message %}
<div class="alert alert-{{ level or 'info' }}">{{ message }}</div>
{% endif %}

<div class="card" style="margin-bottom: 24px;">
    <div class="card-header">
        <span class="card-title">Request Article</span>
    </div>
    {% if contacts %}
    <form method="post" action="/guests/request">
        <div style="display: flex; gap: 12px; align-items: flex-end; flex-wrap: wrap;">
            <div class="form-group" style="margin-bottom: 0;">
                <label>Contact</label>
                <select name="contact_id" class="select-sm" style="width: 200px;">
                    {% for c in contacts %}
                    <option value="{{ c.id }}">{{ c.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <label>Topic</label>
                <input name="topic" placeholder="Article topic" style="width: 250px;">
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <label>Notes</label>
                <input name="notes" placeholder="Additional notes" style="width: 200px;">
            </div>
            <button type="submit" class="btn btn-primary btn-sm">Request</button>
        </div>
    </form>
    {% else %}
    <p style="color: var(--text-dim);">Add a contact first to request articles.</p>
    {% endif %}
</div>

<div class="card" style="margin-bottom: 24px;">
    <div class="card-header">
        <span class="card-title">Articles</span>
    </div>
    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Permission</th>
                    <th>Section</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for article in articles %}
                <tr>
                    <td><strong>{{ article.title or '(untitled)' }}</strong></td>
                    <td>{{ article.author_name or article.contact_name or '—' }}</td>
                    <td><span class="badge badge-{{ article.permission_state }}">{{ article.permission_state }}</span></td>
                    <td>{{ article.target_section_slug or '—' }}</td>
                    <td><a href="/guests/{{ article.id }}" class="btn btn-ghost btn-sm">View</a></td>
                </tr>
                {% endfor %}
                {% if not articles %}
                <tr><td colspan="5" style="text-align: center; color: var(--text-dim);">No articles yet.</td></tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <span class="card-title">Contacts</span>
    </div>
    <form method="post" action="/guests/contacts/add" style="margin-bottom: 16px;">
        <div style="display: flex; gap: 8px; flex-wrap: wrap; align-items: flex-end;">
            <div class="form-group" style="margin-bottom: 0;">
                <label>Name</label>
                <input name="name" required placeholder="Full name" style="width: 160px;">
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <label>Email</label>
                <input name="email" type="email" placeholder="email" style="width: 180px;">
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <label>Organization</label>
                <input name="organization" placeholder="Company" style="width: 140px;">
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <label>Role</label>
                <input name="role" placeholder="Title" style="width: 120px;">
            </div>
            <button type="submit" class="btn btn-primary btn-sm">Add Contact</button>
        </div>
    </form>

    <div id="contacts-table">
        {% include "partials/guest_contacts_table.html" %}
    </div>
</div>
{% endblock %}
