{% extends "base.html" %}
{% block title %}Editorial Calendar â€” TrueFans AMP{% endblock %}
{% block nav_calendar %}active{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Editorial Calendar</h2>
    <p>Plan upcoming issues with themes, sections, and agent assignments.</p>
</div>

{% if message %}
<div class="alert alert-{{ level or 'info' }}">{{ message }}</div>
{% endif %}

<div class="card" style="margin-bottom: 24px;">
    <div class="card-header">
        <span class="card-title">Plan New Issue</span>
    </div>
    <form method="post" action="/calendar/plan">
        <div style="display: flex; gap: 12px; align-items: flex-end; flex-wrap: wrap;">
            <div class="form-group" style="margin-bottom: 0;">
                <label>Issue</label>
                <select name="issue_id" class="select-sm" style="width: 200px;">
                    <option value="0">New (no issue yet)</option>
                    {% for issue in upcoming_issues %}
                    <option value="{{ issue.id }}">#{{ issue.issue_number }} {{ issue.title }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <label>Planned Date</label>
                <input name="planned_date" type="date" style="width: 160px;">
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <label>Theme</label>
                <input name="theme" placeholder="Issue theme" style="width: 200px;">
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <label>Notes</label>
                <input name="notes" placeholder="Additional notes" style="width: 200px;">
            </div>
            <button type="submit" class="btn btn-primary btn-sm">Create Entry</button>
        </div>
    </form>
</div>

<div class="card">
    <div class="card-header">
        <span class="card-title">Calendar</span>
    </div>
    {% if calendar %}
    <div class="calendar-grid">
        {% for entry in calendar %}
        <div class="calendar-cell">
            <div class="calendar-issue">
                <strong>
                    {% if entry.issue_number %}
                    #{{ entry.issue_number }} {{ entry.issue_title or '' }}
                    {% else %}
                    Unlinked
                    {% endif %}
                </strong>
                <span class="badge badge-{{ entry.status }}">{{ entry.status }}</span>
            </div>
            {% if entry.planned_date %}
            <div style="font-size: 12px; color: var(--text-dim);">{{ entry.planned_date }}</div>
            {% endif %}
            {% if entry.theme %}
            <div style="font-size: 14px; margin-top: 6px; color: var(--accent);">{{ entry.theme }}</div>
            {% endif %}
            {% if entry.notes %}
            <div style="font-size: 13px; margin-top: 4px; color: var(--text-dim);">{{ entry.notes }}</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="icon">&#128467;</div>
        <h3>No calendar entries</h3>
        <p>Plan your first issue above.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
